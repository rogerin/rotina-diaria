name: daily-note
on:
  schedule:
    - cron: "0 11 * * *"  # 08:00 America/Recife
  workflow_dispatch:

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set date env
        run: |
          TZ="America/Recife"
          echo "TODAY=$(date +'%Y/%m/%d')" >> $GITHUB_ENV
          echo "YEAR=$(date +'%Y')" >> $GITHUB_ENV
          echo "MONTH=$(date +'%m')" >> $GITHUB_ENV

      - name: Create folder
        run: |
          mkdir -p "${{ env.YEAR }}/${{ env.MONTH }}"

      - name: Generate daily markdown if not exists
        run: |
          FILE="${{ env.YEAR }}/${{ env.MONTH }}/${{ env.TODAY }}.md"
          if [ ! -f "$FILE" ]; then
            RECIFE_DATE=$(TZ=America/Recife date +'%d/%m/%Y')
            {
              echo "# ðŸ—“ï¸ Checklist Diario, $RECIFE_DATE"
              echo ""
              echo "## ðŸš¤ Projeto BeSail"
              echo "- [ ] Testar URL do backend"
              echo "- [ ] Publicar no GitLab"
              echo "- [ ] Publicar no GitHub"
              echo "- [ ] Validar subdominio na infra"
              echo "- [ ] Testar deploy automatico"
              echo "- [ ] Verificar variaveis de ambiente (.env)"
              echo ""
              echo "## ðŸƒ Projeto StridAPP"
              echo "- [ ] Validar interface anterior"
              echo "- [ ] Checar API e definir rotas"
              echo "- [ ] Documentar como no padrao KeyCore"
              echo ""
              echo "## ðŸ§  Projeto Gemeos Digitais"
              echo "- [ ] Perguntar por nome"
              echo "- [ ] Criar lista de atividades"
              echo "- [ ] Validar com dono"
              echo ""
              echo "---"
              echo ""
              echo "### ðŸ•˜ Sugestao de rotina"
              echo "| Horario | Atividade |"
              echo "|--------|-----------|"
              echo "| 08:00 , 08:30 | BeSail, testes e deploy |"
              echo "| 08:30 , 09:15 | StridAPP, revisao e documentacao |"
              echo "| 09:15 , 09:45 | Gemeos Digitais, planejamento |"
              echo "| 09:45 , 10:00 | Revisar pendencias |"
            } > "$FILE"
          fi

      - name: Commit changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore: nota diaria, ${{ env.TODAY }}"
          file_pattern: "${{ env.YEAR }}/${{ env.MONTH }}/*.md"
