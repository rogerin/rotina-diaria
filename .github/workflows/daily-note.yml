name: daily-note
on:
  schedule:
    - cron: "0 11 * * *"  # 08:00 America/Recife
  workflow_dispatch:

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set date env
        run: |
          TZ="America/Recife"
          echo "TODAY=$(date +'%Y/%m/%d')" >> $GITHUB_ENV
          echo "YEAR=$(date +'%Y')" >> $GITHUB_ENV
          echo "MONTH=$(date +'%m')" >> $GITHUB_ENV

      - name: Create folder
        run: |
          mkdir -p "${{ env.YEAR }}/${{ env.MONTH }}"

      - name: Generate daily markdown if not exists
        run: |
          FILE="${{ env.YEAR }}/${{ env.MONTH }}/${{ env.TODAY }}.md"
          if [ ! -f "$FILE" ]; then
            RECIFE_DATE=$(TZ=America/Recife date +'%d/%m/%Y')
            echo "# Checklist Diario, $RECIFE_DATE" > "$FILE"
          fi

      - name: Commit changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore: nota diaria, ${{ env.TODAY }}"
          file_pattern: "${{ env.YEAR }}/${{ env.MONTH }}/*.md"
